<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¶ï¸ MalanguÃ­simas - Sistema de Inventario</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <h1>ğŸŒ¶ï¸ MalanguÃ­simas</h1>
            <p>Sistema de Inventario y Ventas</p>
            <form onsubmit="iniciarSesion(event)">
                <div class="input-group">
                    <label>CÃ³digo de Acceso:</label>
                    <input type="password" id="codigoAcceso" placeholder="Ingresa el cÃ³digo" required>
                </div>
                <button type="submit" class="btn">ğŸ” Ingresar al Sistema</button>
            </form>
            <div id="loginError" class="alert alert-error hidden" style="margin-top: 20px;">
                CÃ³digo incorrecto. Intenta nuevamente.
            </div>
        </div>
    </div>

    <!-- Sync Status Indicator -->
    <div id="syncStatus" class="sync-status hidden">
        <span id="syncText">âœ… Sincronizado</span>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸŒ¶ï¸ MalanguÃ­simas</h1>
            <p>Sistema de Inventario y Ventas - En lÃ­nea</p>
            <div style="margin-top: 15px;">
                <button class="btn btn-secondary" onclick="sincronizarDatos()" style="margin: 5px;">ğŸ”„ Sincronizar</button>
                <button class="btn btn-danger" onclick="cerrarSesion()" style="margin: 5px;">ğŸšª Salir</button>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="main-grid">
            <!-- Inventario -->
            <div class="card">
                <h2>ğŸ“¦ Inventario</h2>
                <button class="btn" onclick="mostrarInventario()">Ver Inventario Completo</button>
                <button class="btn btn-secondary" onclick="mostrarModal('agregarStockModal')">â• Agregar Stock</button>
                <button class="btn btn-danger" onclick="mostrarModal('quitarStockModal')">â– Quitar Stock</button>
                <button class="btn btn-warning" onclick="mostrarModal('convertirStockModal')">ğŸ”„ Convertir TamaÃ±os</button>
                <button class="btn btn-warning" onclick="mostrarModal('actualizarCostosModal')">ğŸ’° Actualizar Costos</button>
            </div>

            <!-- Ventas -->
            <div class="card">
                <h2>ğŸ›’ Ventas</h2>
                <button class="btn" onclick="mostrarModal('ventaMenudeoModal')">ğŸ›’ Venta Menudeo</button>
                <button class="btn" onclick="mostrarModal('ventaMayoreoModal')">ğŸª Venta Mayoreo</button>
                <button class="btn btn-warning" onclick="mostrarModal('regaladaModal')">ğŸ Registrar Regalada</button>
                <button class="btn btn-secondary" onclick="mostrarModal('envioModal')">ğŸ“¦ Registrar EnvÃ­o</button>
                <button class="btn btn-danger" onclick="mostrarCancelarVenta()">âŒ Cancelar Venta</button>
                <button class="btn btn-secondary" onclick="mostrarReportes()">ğŸ“Š Ver Reportes</button>
            </div>

            <!-- InformaciÃ³n -->
            <div class="card">
                <h2>ğŸ’² Precios</h2>
                <div class="price-list">
                    <div class="price-row">
                        <strong>TamaÃ±o 50g:</strong>
                        <span>Mayoreo $20.00 | Menudeo $25.00</span>
                    </div>
                    <div class="price-row">
                        <strong>TamaÃ±o 100g:</strong>
                        <span>Mayoreo $33.00 | Menudeo $40.00</span>
                    </div>
                    <div class="price-row" style="border-top: 2px solid #ff6b35; padding-top: 10px; margin-top: 10px;">
                        <strong>Costos de Compra:</strong>
                        <span>50g: $15.00 | 100g: $23.00</span>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="mostrarModal('gastosModal')">ğŸ’¸ Registrar Gasto</button>
            </div>
        </div>

        <!-- Nueva secciÃ³n de AnÃ¡lisis -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>ğŸ“ˆ AnÃ¡lisis y Tendencias</h2>
            <button class="btn" onclick="mostrarTendencias()">ğŸ“Š Ver Tendencias de Ventas</button>
            <button class="btn btn-secondary" onclick="mostrarRecomendaciones()">ğŸ’¡ Recomendaciones de Stock</button>
        </div>

        <!-- EstadÃ­sticas RÃ¡pidas -->
        <div class="card">
            <h2>ğŸ“Š EstadÃ­sticas del DÃ­a</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="ventasHoy">0</div>
                    <div>Ventas Hoy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="ingresosHoy">$0</div>
                    <div>Ingresos Hoy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="productosStock">0</div>
                    <div>Productos en Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="ultimaSinc">--:--</div>
                    <div>Ãšltima SincronizaciÃ³n</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Agregar Stock -->
    <div id="agregarStockModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('agregarStockModal')">&times;</span>
            <h2>â• Agregar Stock</h2>
            <form onsubmit="agregarStock(event)">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborStock" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oStock" required>
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g</option>
                        <option value="100">100g</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cantidad a agregar:</label>
                    <input type="number" id="cantidadStock" min="1" required>
                </div>
                <button type="submit" class="btn">âœ… Agregar Stock</button>
            </form>
        </div>
    </div>

    <!-- Modal: Quitar Stock -->
    <div id="quitarStockModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('quitarStockModal')">&times;</span>
            <h2>â– Quitar Stock</h2>
            <form onsubmit="quitarStock(event)">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborQuitar" required onchange="mostrarStockActual()">
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oQuitar" required onchange="mostrarStockActual()">
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g</option>
                        <option value="100">100g</option>
                    </select>
                </div>
                <div id="stockActualInfo" class="alert alert-warning hidden" style="margin: 15px 0;">
                    Stock actual: <strong id="stockActualTexto">0</strong> unidades
                </div>
                <div class="input-group">
                    <label>Cantidad a quitar:</label>
                    <input type="number" id="cantidadQuitar" min="1" required>
                </div>
                <div class="input-group">
                    <label>Motivo (opcional):</label>
                    <select id="motivoQuitar">
                        <option value="daÃ±ado">Producto daÃ±ado</option>
                        <option value="vencido">Producto vencido</option>
                        <option value="perdida">PÃ©rdida/Robo</option>
                        <option value="ajuste">Ajuste de inventario</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-danger">âŒ Quitar del Stock</button>
            </form>
        </div>
    </div>

    <!-- Modal: Venta Menudeo -->
    <div id="ventaMenudeoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('ventaMenudeoModal')">&times;</span>
            <h2>ğŸ›’ Venta Menudeo</h2>
            <form onsubmit="registrarVenta(event, 'menudeo')">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborVentaM" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oVentaM" required onchange="actualizarPrecioVenta('M')">
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g - $25.00</option>
                        <option value="100">100g - $40.00</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadVentaM" min="1" required onchange="calcularTotalVenta('M')">
                </div>
                <div class="input-group">
                    <label>Total a cobrar:</label>
                    <input type="text" id="totalVentaM" readonly style="background: #f0f0f0; font-weight: bold; font-size: 1.2em;">
                </div>
                <button type="submit" class="btn">ğŸ’° Registrar Venta</button>
            </form>
        </div>
    </div>

    <!-- Modal: Venta Mayoreo -->
    <div id="ventaMayoreoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('ventaMayoreoModal')">&times;</span>
            <h2>ğŸª Venta Mayoreo</h2>
            <form onsubmit="registrarVenta(event, 'mayoreo')">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborVentaMay" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oVentaMay" required onchange="actualizarPrecioVenta('May')">
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g - $20.00</option>
                        <option value="100">100g - $33.00</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadVentaMay" min="1" required onchange="calcularTotalVenta('May')">
                </div>
                <div class="input-group">
                    <label>Total a cobrar:</label>
                    <input type="text" id="totalVentaMay" readonly style="background: #f0f0f0; font-weight: bold; font-size: 1.2em;">
                </div>
                <button type="submit" class="btn">ğŸ’° Registrar Venta</button>
            </form>
        </div>
    </div>

    <!-- Modal: Actualizar Costos -->
    <div id="actualizarCostosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('actualizarCostosModal')">&times;</span>
            <h2>ğŸ’° Actualizar Costos</h2>
            <form onsubmit="actualizarCostos(event)">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborCosto" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oCosto" required>
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g</option>
                        <option value="100">100g</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Costo de producciÃ³n:</label>
                    <input type="number" id="costoProduccion" step="0.01" min="0" required>
                </div>
                <button type="submit" class="btn">âœ… Actualizar Costo</button>
            </form>
        </div>
    </div>

    <!-- Modal: Registrar Gasto -->
    <div id="gastosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('gastosModal')">&times;</span>
            <h2>ğŸ’¸ Registrar Gasto</h2>
            <form onsubmit="registrarGasto(event)">
                <div class="input-group">
                    <label>Concepto:</label>
                    <input type="text" id="conceptoGasto" required placeholder="Ej: Compra de chiles">
                </div>
                <div class="input-group">
                    <label>Monto:</label>
                    <input type="number" id="montoGasto" step="0.01" min="0" required>
                </div>
                <div class="input-group">
                    <label>CategorÃ­a:</label>
                    <select id="categoriaGasto">
                        <option value="operativo">Operativo</option>
                        <option value="materia_prima">Materia Prima</option>
                        <option value="transporte">Transporte</option>
                        <option value="equipamiento">Equipamiento</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                <button type="submit" class="btn">âœ… Registrar Gasto</button>
            </form>
        </div>
    </div>

    <!-- Modal: Registrar Regalada -->
    <div id="regaladaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('regaladaModal')">&times;</span>
            <h2>ğŸ Registrar Regalada (Muestra)</h2>
            <form onsubmit="registrarRegalada(event)">
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborRegalada" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oRegalada" required>
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g</option>
                        <option value="100">100g</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cantidad regalada:</label>
                    <input type="number" id="cantidadRegalada" min="1" required>
                </div>
                <div class="input-group">
                    <label>Punto de venta (opcional):</label>
                    <input type="text" id="puntoVenta" placeholder="Ej: Tienda El Ahorro">
                </div>
                <button type="submit" class="btn btn-warning">ğŸ Registrar Regalada</button>
            </form>
        </div>
    </div>

    <!-- Modal: Convertir Stock -->
    <div id="convertirStockModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('convertirStockModal')">&times;</span>
            <h2>ğŸ”„ Convertir TamaÃ±os</h2>
            <form onsubmit="convertirStock(event)">
                <div class="input-group">
                    <label>Tipo de conversiÃ³n:</label>
                    <select id="tipoConversion" required onchange="actualizarInfoConversion()">
                        <option value="">Selecciona tipo</option>
                        <option value="100a50">ğŸ“¦ 100g â†’ 50g (1 bolsa grande = 2 bolsas chicas)</option>
                        <option value="50a100">ğŸ“¦ 50g â†’ 100g (2 bolsas chicas = 1 bolsa grande)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborConvertir" required onchange="mostrarStockConversion()">
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div id="stockConversionInfo" class="alert alert-warning hidden" style="margin: 15px 0;">
                    <div id="stockOrigenTexto"></div>
                    <div id="conversionResultado"></div>
                </div>
                <div class="input-group">
                    <label id="labelCantidadConvertir">Cantidad a convertir:</label>
                    <input type="number" id="cantidadConvertir" min="1" required onchange="calcularResultadoConversion()">
                </div>
                <button type="submit" class="btn btn-warning">ğŸ”„ Realizar ConversiÃ³n</button>
            </form>
        </div>
    </div>

    <!-- Modal: Registrar EnvÃ­o -->
    <div id="envioModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('envioModal')">&times;</span>
            <h2>ğŸ“¦ Registrar EnvÃ­o</h2>
            <form onsubmit="registrarEnvio(event)">
                <div class="input-group">
                    <label>Cliente/Destino:</label>
                    <input type="text" id="clienteEnvio" required placeholder="Nombre del cliente o destino">
                </div>
                <div class="input-group">
                    <label>Sabor:</label>
                    <select id="saborEnvio" required>
                        <option value="">Selecciona un sabor</option>
                        <option value="fuego">ğŸ”¥ Fuego</option>
                        <option value="misterio">ğŸŒŸ Misterio</option>
                        <option value="habanero">ğŸŒ¶ï¸ Habanero</option>
                        <option value="jalapeÃ±o">ğŸ«‘ JalapeÃ±o</option>
                        <option value="adobadas">ğŸ§‚ Adobadas</option>
                        <option value="naturales">ğŸ¥¬ Naturales</option>
                        <option value="especias">âœ¨ Especias</option>
                        <option value="chipotle">ğŸ”¥ Chipotle</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>TamaÃ±o:</label>
                    <select id="tamaÃ±oEnvio" required onchange="actualizarPrecioEnvio()">
                        <option value="">Selecciona tamaÃ±o</option>
                        <option value="50">50g</option>
                        <option value="100">100g</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Cantidad:</label>
                    <input type="number" id="cantidadEnvio" min="1" required onchange="calcularTotalEnvio()">
                </div>
                <div class="input-group">
                    <label>Tipo de precio:</label>
                    <select id="tipoPrecioEnvio" required onchange="calcularTotalEnvio()">
                        <option value="mayoreo">Mayoreo</option>
                        <option value="menudeo">Menudeo</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Costo de envÃ­o:</label>
                    <input type="number" id="costoEnvio" step="0.01" min="0" required onchange="calcularTotalEnvio()">
                </div>
                <div class="alert alert-warning" style="margin: 15px 0;">
                    <strong>Subtotal producto:</strong> $<span id="subtotalEnvio">0.00</span><br>
                    <strong>Costo envÃ­o:</strong> $<span id="costoEnvioMostrar">0.00</span><br>
                    <strong>Total a cobrar:</strong> $<span id="totalEnvio" style="font-size: 1.2em;">0.00</span>
                </div>
                <button type="submit" class="btn btn-secondary">ğŸ“¦ Registrar EnvÃ­o</button>
            </form>
        </div>
    </div>

    <!-- Modal: Inventario -->
    <div id="inventarioModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="cerrarModal('inventarioModal')">&times;</span>
            <h2>ğŸ“¦ Inventario Completo</h2>
            <div id="inventarioContent"></div>
        </div>
    </div>

    <!-- Modal: Reportes -->
    <div id="reportesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="cerrarModal('reportesModal')">&times;</span>
            <h2>ğŸ“Š Reportes de Ventas</h2>
            <div id="reportesContent" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Modal: Cancelar Venta -->
    <div id="cancelarVentaModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="cerrarModal('cancelarVentaModal')">&times;</span>
            <h2>âŒ Cancelar Venta</h2>
            <div id="listadoVentasContent" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Modal: Tendencias -->
    <div id="tendenciasModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="cerrarModal('tendenciasModal')">&times;</span>
            <h2>ğŸ“ˆ Tendencias de Ventas</h2>
            <div id="tendenciasContent" style="max-height: 70vh; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Alertas -->
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>

    <script src="app.js"></script>
</body>
</html>